"use strict";angular.module("frontendApp",["ngCookies","ngResource","ngSanitize","ngRoute","ui.codemirror","LocalStorageModule"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]).config(["localStorageServiceProvider",function(a){a.setPrefix("battleships")}]),angular.module("frontendApp").controller("MainCtrl",["$scope","Board","Bot","$http","$q","localStorageService",function(a,b,c,d,e,f){a.settings={language:"python",hasWon:!1,isOver:!1,initialCall:!0,gameStart:!1,hasError:!1,errorMsg:""},a.history={},a.history.player=[],a.history.computer=[],a.board={},a.initPlayerSolution=function(){var b=f.get("playerSolution_"+a.settings.language);return null===b&&(b=c.getSample(a.settings.language)),b},a.playerBot={name:"lamkeewei",language:a.settings.language,solution:a.initPlayerSolution()},a.computerBot={name:"lamkeewei",language:a.settings.language,solution:c.getSample(a.settings.language)},a.$watch("playerBot.solution",function(b){f.add("playerSolution_"+a.settings.language,b)}),a.parseBoard=function(a){var b=[],c=a.split("|");return c.forEach(function(a){var c=[];a.split("").forEach(function(a){a="-"===a?"":a,c.push(a)}),b.push(c)}),b},a.currentLevel=1;var g="-------|-------|-------|-------|-------|-------|-------";a.playerBot.board=a.parseBoard(g),a.computerBot.board=a.parseBoard(g),a.hasWon=function(){return a.settings.hasWon&&!a.settings.initialCall&&a.settings.isOver},a.hasLost=function(){return!a.settings.hasWon&&!a.settings.initialCall&&a.settings.isOver},a.serializeBoard=function(a){var b="";return a.forEach(function(a){a.forEach(function(a){a=""===a?"-":a,b+=a}),b+="|"}),b=b.substring(0,b.length-1)},a.startGame=function(){b.initializeBoards().then(function(b){a.playerBot.board=a.parseBoard(b.player),a.computerBot.board=a.parseBoard(b.bot),a.settings.hasWon=!1,a.settings.isOver=!1,a.settings.initialCall=!1,a.settings.hasError=!1,a.settings.errorMsg="",a.settings.gameStart=!0,a.history={},a.history.player=[],a.history.computer=[],a.playGame()})},a.playGame=function(){var b={language:a.settings.language,solution:a.playerBot.solution,board:a.serializeBoard(a.computerBot.board)},c={language:a.settings.language,solution:a.computerBot.solution,board:a.serializeBoard(a.playerBot.board)};e.all([d.post("Game/getNewBoard",c),d.post("Game/getNewBoard",b)]).then(function(b){var c=b[0].data,d=b[1].data;return"error"===c.status||"error"===d.status?(a.settings.hasError=!0,a.settings.errorMsg=d.message,console.log(c.errors),console.log(d.errors),!1):(a.computerBot.board=a.parseBoard(d.newBoard),a.playerBot.board=a.parseBoard(c.newBoard),a.history.computer.push(a.computerBot.board),a.history.player.push(a.playerBot.board),d.winningStatus||c.winningStatus?(d.winningStatus&&(a.settings.hasWon=!0),a.settings.isOver=!0,!1):void a.playGame())})},a.reset=function(){a.settings.hasWon=!1,a.settings.isOver=!1,a.settings.initialCall=!0,a.settings.hasError=!1,a.settings.errorMsg="";var b="-------|-------|-------|-------|-------|-------|-------";a.playerBot.board=a.parseBoard(b),a.computerBot.board=a.parseBoard(b)}}]),angular.module("frontendApp").controller("BoardCtrl",["$scope","Board",function(a){a.isShip=function(b){return"s"===b&&a.settings.gameStart},a.isMiss=function(a){return"m"===a},a.isHit=function(a){return"h"===a},a.$watch("board",function(){},!0)}]),angular.module("frontendApp").factory("Board",["$http","$q",function(a,b){return{initializeBoards:function(){var c=b.defer();return a.get("Board/initialize").then(function(a){c.resolve(a.data)}),c.promise}}}]),angular.module("frontendApp").factory("Board",["$http","$q",function(a,b){return{initializeBoards:function(){var c=b.defer();return a.get("Board/initialize").then(function(a){c.resolve(a.data)}),c.promise}}}]),angular.module("frontendApp").factory("Bot",["$http","$q",function(a,b){return{saveBot:function(c){var d=b.defer();return a.post("Bot/create",c).then(function(a){d.resolve(a.data)}),d.promise},getAllBots:function(){var c=b.defer();return a.get("Bot/all").then(function(a){c.resolve(a.data)}),c.promise},getChallengeBots:function(){return[]},getSample:function(a){switch(a){case"javascript":return"function getMove(boardStr) {\n  //Write your code here...\n  return boardStr;\n}";case"java":return"public static void getMove(String boardStr){\n  //Write your code here...\n  return boardStr;\n}";case"python":return'def getMove(boardStr):\n  # Write your code here\n  return boardStr.replace("-","b",1)'}}}}]),angular.module("frontendApp").controller("BotCtrl",["$scope","Bot",function(a,b){a.playerOptions={lineWrapping:!0,lineNumbers:!0,theme:"monokai",mode:a.settings.language,autoCloseBrackets:!0},a.botOptions={lineWrapping:!0,lineNumbers:!0,theme:"monokai",mode:a.settings.language,readOnly:"nocursor",autoCloseBrackets:!0},b.getAllBots().then(function(b){a.bots=b}),a.$watch("settings.language",function(c,d){d!==c&&(console.log("chagned"),a.botOptions.mode="java"===c?"clike":c,a.playerOptions.mode="java"===c?"clike":c,a.playerBot.language=c,a.playerBot.solution=a.initPlayerSolution(),a.computerBot.language=c,a.computerBot.solution=b.getSample(c))}),a.saveBot=function(){console.log(a.botOptions.mode)}}]);