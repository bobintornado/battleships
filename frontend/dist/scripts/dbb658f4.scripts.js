"use strict";angular.module("frontendApp",["ngCookies","ngResource","ngSanitize","ngRoute","ui.codemirror","LocalStorageModule","ui.bootstrap","firebase"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",resolve:{allBots:["Bot",function(a){return a.getAllBots()}],percentileBots:["Bot",function(a){return a.getChallengeBots()}]}}).otherwise({redirectTo:"/"})}]).config(["localStorageServiceProvider",function(a){a.setPrefix("battleships")}]).factory("ga",function(){return window.ga}).factory("Firebase",function(){return window.Firebase}),angular.module("frontendApp").controller("MainCtrl",["$scope","Board","Bot","$http","$q","localStorageService","$modal","allBots","percentileBots","filterFilter","$firebase","$firebaseSimpleLogin","Firebase","$rootScope","ga",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){g.open({templateUrl:"views/help.html"});var p=new m("https://battleships-is306.firebaseio.com/");a.loginObj=l(p),a.isLogin=!1,n.$on("$firebaseSimpleLogin:login",function(){o("send","event","button","click","login"),a.isLogin=!0}),n.$on("$firebaseSimpleLogin:logout",function(){a.isLogin=!1}),a.percentileBots=i,a.allBots=h,a.getMaxScore=function(){var b=0;return a.allBots.forEach(function(a){var c=a.score;c>b&&(b=c)}),b.toFixed(2)},a.maxScore=a.getMaxScore(),a.settings={language:"python",hasWon:!1,isOver:!1,initialCall:!0,gameStart:!1,hasError:!1,errorMsg:"",selectedBot:""},a.settings.selectedBot=j(a.percentileBots,{language:a.settings.language}),a.settings.selectedBot.length>0&&(a.settings.selectedBot=a.settings.selectedBot[0].name),a.history={},a.history.player=[],a.history.computer=[],a.board={},a.initPlayerSolution=function(){var b=f.get("playerSolution_"+a.settings.language);return null===b&&(b=c.getSample(a.settings.language)),b},a.playerBot={name:"lamkeewei",language:a.settings.language,solution:a.initPlayerSolution()},a.computerBot={name:"lamkeewei",language:a.settings.language,solution:c.getSample(a.settings.language)},a.$watch("playerBot.solution",function(b){f.add("playerSolution_"+a.settings.language,b)}),a.parseBoard=function(a){var b=[],c=a.split("|");return c.forEach(function(a){var c=[];a.split("").forEach(function(a){a="-"===a?"":a,c.push(a)}),b.push(c)}),b},a.getBot=function(b){var c={};return a.percentileBots.forEach(function(a){a.name===b&&(c=a)}),c},a.$watch("settings.selectedBot",function(b){var c=j(a.percentileBots,{language:a.settings.language});c.length>0&&(a.computerBot.solution=a.getBot(b).code)}),a.currentLevel=1;var q="-------|-------|-------|-------|-------|-------|-------";a.playerBot.board=a.parseBoard(q),a.computerBot.board=a.parseBoard(q),a.hasWon=function(){return a.settings.hasWon&&!a.settings.initialCall&&a.settings.isOver},a.hasLost=function(){return!a.settings.hasWon&&!a.settings.initialCall&&a.settings.isOver},a.serializeBoard=function(a){var b="";return a.forEach(function(a){a.forEach(function(a){a=""===a?"-":a,b+=a}),b+="|"}),b=b.substring(0,b.length-1)},a.startGame=function(){b.initializeBoards().then(function(b){a.playerBot.board=a.parseBoard(b.player),a.computerBot.board=a.parseBoard(b.bot),a.settings.hasWon=!1,a.settings.isOver=!1,a.settings.initialCall=!1,a.settings.hasError=!1,a.settings.errorMsg="",a.settings.gameStart=!0,a.history={},a.history.player=[],a.history.computer=[],a.playGame()})},a.playGame=function(){var b=a.settings.language,c={language:b,solution:a.playerBot.solution,board:a.serializeBoard(a.computerBot.board)},f={language:b,solution:a.computerBot.solution,board:a.serializeBoard(a.playerBot.board)};e.all([d.post("Game/getNewBoard",f),d.post("Game/getNewBoard",c)]).then(function(b){var c=b[0].data,e=b[1].data;if(!c||!e)return a.settings.hasError=!0,a.settings.errorMsg="Service is busy at the moment!",a.settings.feedback="Please try again later!",!1;if("error"===c.status||"error"===e.status)return a.settings.hasError=!0,a.settings.errorMsg=e.message,a.settings.feedback="Method output: "+e.generateStr,a.settings.compileError=e.errors,!1;if(a.computerBot.board=a.parseBoard(e.newBoard),a.playerBot.board=a.parseBoard(c.newBoard),a.settings.playerString=e.generateStr,a.history.computer.push(a.computerBot.board),a.history.player.push(a.playerBot.board),e.winningStatus||c.winningStatus){a.settings.gameStart=!1,e.winningStatus&&(a.settings.hasWon=!0);var f;f=e.winningStatus===c.winningStatus?1:e.winningStatus?0:2,console.log(c),console.log(e);var g={name1:e.bot.name,name2:c.bot.name,result:f};return d.post("/Game/addResult",g).success(function(b){console.log(b),a.settings.isOver=!0}),!1}a.playGame()},function(){a.settings.hasError=!0,a.settings.errorMsg="Verification service is down :(",a.settings.feedback="Try again later!"})},a.reset=function(){a.settings.hasWon=!1,a.settings.isOver=!1,a.settings.initialCall=!0,a.settings.hasError=!1,a.settings.errorMsg="";var b="-------|-------|-------|-------|-------|-------|-------";a.playerBot.board=a.parseBoard(b),a.computerBot.board=a.parseBoard(b)},a.showCompileError=function(){console.log("error"),g.open({templateUrl:"views/compile.html",controller:"CompileCtrl",resolve:{errorMsg:function(){return a.settings.compileError}}})},a.viewHistory=function(){a.settings.hasWon=!1,a.settings.isOver=!1,a.settings.initialCall=!0,a.settings.hasError=!1,a.settings.errorMsg="";var b="-------|-------|-------|-------|-------|-------|-------";a.playerBot.board=a.parseBoard(b),a.computerBot.board=a.parseBoard(b),g.open({templateUrl:"views/history.html",controller:"HistoryCtrl",resolve:{history:function(){return a.history.player}}})}}]),angular.module("frontendApp").controller("BoardCtrl",["$scope","Board",function(a){a.isShip=function(b){return"s"===b&&a.settings.gameStart},a.isMiss=function(a){return"m"===a},a.isHit=function(a){return"h"===a},a.$watch("board",function(){},!0)}]),angular.module("frontendApp").factory("Board",["$http","$q",function(a,b){return{initializeBoards:function(){var c=b.defer();return a.get("Board/initialize").then(function(a){c.resolve(a.data)}),c.promise}}}]),angular.module("frontendApp").factory("Board",["$http","$q",function(a,b){return{initializeBoards:function(){var c=b.defer();return a.get("Board/initialize").then(function(a){c.resolve(a.data)}),c.promise}}}]),angular.module("frontendApp").factory("Bot",["$http","$q",function(a,b){return{saveBot:function(c){var d=b.defer();return a.post("Bot/create",c).then(function(a){d.resolve(a.data)}),d.promise},getAllBots:function(){var c=b.defer();return a.get("Bot/all").success(function(a){c.resolve(a)}),c.promise},getChallengeBots:function(){var c=b.defer();return a.get("Bot/percentile10").success(function(a){c.resolve(a)}),c.promise},getSample:function(a){switch(a){case"js":return'function getMove(boardStr) {\n  // Your code should return a string like:\n  // ----b--|-------|-------|-------|-------|-------|-------\n  // Where "b" is where you want to place your bomb\n\n  return boardStr.replace("-","b");\n}';case"java":return'public static String getMove(String boardStr){\n  //Write your code here...\n  return boardStr.replace("-","b");\n}';case"python":return'def getMove(boardStr):\n  # Your code should return a string like:\n  # ----b--|-------|-------|-------|-------|-------|-------\n  # Where "b" is where you want to place your bomb\n\n  return boardStr.replace("-","b",1)'}}}}]),angular.module("frontendApp").controller("BotCtrl",["$scope","Bot","filterFilter",function(a,b,c){a.playerOptions={lineWrapping:!0,lineNumbers:!0,theme:"monokai",mode:a.settings.language,autoCloseBrackets:!0},a.botOptions={lineWrapping:!0,lineNumbers:!0,theme:"monokai",mode:a.settings.language,readOnly:"nocursor",autoCloseBrackets:!0},b.getAllBots().then(function(b){a.bots=b}),a.$watch("settings.language",function(d,e){if(e!==d){var f=d;"java"===f?f="text/x-java":"js"===f&&(f="javascript"),a.settings.selectedBot=c(a.percentileBots,{language:d}),a.settings.selectedBot.length>0?a.settings.selectedBot=a.settings.selectedBot[0].name:a.computerBot.solution=b.getSample(d),a.botOptions.mode=f,a.playerOptions.mode=f,a.playerBot.language=d,a.playerBot.solution=a.initPlayerSolution(),a.computerBot.language=d}}),a.saveBot=function(){console.log(a.botOptions.mode)}}]),angular.module("frontendApp").directive("gaTrack",["ga",function(a){return{restrict:"A",scope:{action:"@gaTrack",label:"@gaLabel"},link:function(b,c){c.bind(b.action,function(){a("send","event","button",b.action,b.label)})}}}]),angular.module("frontendApp").controller("HistoryCtrl",["$scope","history",function(a,b){a.history=b,a.isMiss=function(a){return"m"===a},a.isHit=function(a){return"h"===a}}]),angular.module("frontendApp").controller("CompileCtrl",["$scope","errorMsg",function(a,b){a.errorMsg=b}]);